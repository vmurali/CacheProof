\section{Implementation of the scheduler}
\label{sec:scheduler}

\newcommand{\lWhile}{\textbf{while}}
\newcommand{\lIf}{\textbf{if}}
\newcommand{\lElsIf}{\textbf{else if}}
\newcommand{\lElse}{\textbf{else}}

\floatstyle{plain}
\restylefloat{figure}

\begin{figure}
\small
\begin{boxedminipage}{\linewidth}
\begin{alltt}
\normalfont
\lWhile{} (\(True\)) \bopen
      \lIf (\Resp{c}{n}{a}{x} is in the input channel,
            where \(n = c.parent\)) \bopen
            \lIf (suspended thread \(t\) is waiting for 
                 a response from \(c\) for address \(a\)) \bopen
                   \resume{} \(t\);
            \bclose \lElse \bopen
                   \receive{} \Resp{c}{n}{a}{x};
                   \start{} \dRespL(\(c, n, a, x\));
            \bclose
      \bclose \lElsIf (\Resp{p}{n}{a}{x} is in the input channel,
            where \(p = n.parent\)) \bopen
                   // There must be a suspended thread \(t\)
                   waiting for a response from \(p\) for address \(a\)
                   \resume{} \(t\);
            \bclose
      \bclose \lElsIf (\Req{c}{n}{a}{x} is in the input channel,
                     where \(n = c.parent\)) \bopen
             \lIf (Local-Property \ref{pHandleReq} is satisfied) \bopen
                   \receive{} \Req{c}{n}{a}{x};
                   \start{} \uReq(\(c, n, a, x\));
             \bclose
      \bclose \lElsIf (\Req{p}{n}{a}{x} is in the input channel,
                  where \(p = n.parent\)) \bopen
             \lIf (Local-Property \ref{cHandleReq} is satisfied) \bopen
                   \receive{} \Req{p}{n}{a}{x};
                   \start{} \dReq(\(p, n, a, x\));
             \bclose
      \bclose \lElsIf (suspended thread \(t\) is ready to execute) 
             \resume{} \(t\);
\bclose
\end{alltt}
\end{boxedminipage}
\caption{Implementation of a scheduler for node $n$}
\end{figure}
